<!DOCTYPE html>
<html lang="en">

<!-- HEAD -->
<head>
    <title>Big Houses</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<!-- CONTENT -->
<body>
    <!-- Link to / -->
    <header class="header">
        <div class="header-left">
            <a href="/"> <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo"> </a>
            <h2>Big Houses</h2>
        </div>

        <!-- Include a link to /explore/ and /users/{logname}/. -->
        <div class="header-right">
            <a href="/explore/" class="nav-link">explore</a>
            <a href="/users/{{ logname }}/" class="nav-link">{{ logname }}</a>
        </div>
    </header>

    <main class="post-container">
        <div class="post-card">
            <!-- Post owner and timestamp -->
            <div class="post-header">
                <div class="user-info">
                    <a href="/users/{{post.owner}}/">
                        <img src="/uploads/{{post.owner_pic}}" alt="{{post.owner}} profile pic" class="profile-pic">
                    </a>
                    <div class="post-meta">
                        <a href="/users/{{post.owner}}/" class="username">{{post.owner}}</a>
                        <a href="/posts/{{post.postid}}/" class="timestamp">{{timestamp}}</a>
                    </div>
                </div>
            </div>

            <!-- Post image -->
            <div class="post-image">
                <img src="/uploads/{{post.filename}}" alt="Post image">
            </div>

            <!-- Post actions -->
            <div class="post-actions">
                {% if post.like_owner != logname %}
                    <!-- Like the post -->
                    <form class="action-form" action="{{ url_for('update_likes')}}?target=/posts/{{post.postid}}/" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="operation" value="like"/>
                        <input type="hidden" name="postid" value="{{post.postid}}"/>
                        <button type="submit" name="like" class="action-btn like-btn">â™¡ Like</button>
                    </form>
                {% else %}
                    <!-- Unlike the post -->
                    <form class="action-form" action="{{ url_for('update_likes')}}?target=/posts/{{post.postid}}/" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="operation" value="unlike"/>
                        <input type="hidden" name="postid" value="{{post.postid}}"/>
                        <button type="submit" name="unlike" class="action-btn unlike-btn">â™¥ Unlike</button>
                    </form>
                {% endif %}
                
                {% if post.owner == logname %}
                    <form class="action-form" action="{{ url_for('post')}}?target=/posts/{{post.postid}}/" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="operation" value="delete"/>
                        <input type="hidden" name="postid" value="{{post.postid}}"/>
                        <button type="submit" name="delete" class="action-btn delete-btn">ðŸ—‘ Delete</button>
                    </form>
                {% endif %}
            </div>

            <!-- Likes count -->
            <div class="likes-count">
                {{post.likes}} {{"like" if post.likes == 1 else "likes"}}
            </div>

            <!-- Comments section -->
            <div class="comments-section">
                <div class="comments-list">
                    {% for comment in post.comments %}
                        <div class="comment">
                            <a href="/users/{{comment.owner}}/" class="comment-author">{{comment.owner}}</a>
                            <span class="comment-text">{{comment.text}}</span>
                            {% if comment.owner == logname %}
                                <form class="delete-comment-form" action="{{ url_for('update_comments')}}?target=/posts/{{post.postid}}/" method="post" enctype="multipart/form-data">
                                    <input type="hidden" name="operation" value="delete"/>
                                    <input type="hidden" name="commentid" value="{{comment.commentid}}"/>
                                    <button type="submit" name="uncomment" class="delete-comment-btn">Ã—</button>
                                </form>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>

                <!-- Add new comment -->
                <form class="comment-form" action="{{ url_for('update_comments')}}?target=/posts/{{post.postid}}/" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="operation" value="create"/>
                    <input type="hidden" name="postid" value="{{post.postid}}"/>
                    <input type="text" name="text" placeholder="Add a comment..." required class="comment-input"/>
                    <button type="submit" name="comment" class="comment-btn">Post</button>
                </form>
            </div>
        </div>
    </main>

</body>
</html>

